# 第3章 RabbitMQ高级特性

本章重点

+ 自定义消费者
+ 消息的ACK与重回队列
+ 消息的限流
+ TTL消息
+ 死信队列

## 3.1 消息如何保障100%的投递成功？

### 3.1.1 什么是生产端的可靠性投递

+ 保障消息的成功发出
+ 保障MQ节点的成功接收
+ 发送端收到MQ节点(Broker)确认应答
+ 完善的消息进行补偿机制

### 3.1.2 BAT/TMD互联网大厂的解决方案

+ 消息落库，对消息状态进行打标
  ![消息落库并对消息状态进行打标](images/消息落库并对消息状态进行打标.png)
+ 消息的延迟投递，做二次确认，回调检查，减少数据库操作
  ![二次确认和回调检查](images/二次确认和回调检查.png)

## 3.2 幂等性

> 消费端实现幂等性，就意味着，我们的消息永远不会被消费多次，即使我们收到了多条一样的消息

业界主流的幂等性操作如下

+ 唯一ID+指纹码机制，利用数据库主键去重
  ![唯一ID加指纹码](images/唯一ID加指纹码.png)
+ 利用Redis的原子性去实现幂等性
  ![利用Redis的原子性去实现幂等性](images/利用Redis的原子性去实现幂等性.png)

###
  